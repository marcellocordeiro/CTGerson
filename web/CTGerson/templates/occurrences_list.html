{% extends 'base_logged.html' %}

{% block logged_content %}
    <div class="page-title">
        <h2>Histórico de ocorrências</h2>
        <br />
    </div>

    <div class="page-content">
        {% if occurrences %}
            <table>
                <tr>
                    <th>Data</th>
                    <th>Ônibus</th>
                    <th>Horário do alerta</th>
                    <th>Localização</th>
                    <th>Respondido</th>
                    <th>Horário da resposta</th>
                    <th>Respondente</th>
                    <th>Horário da conclusão</th>
                    <th>Sucesso</th>
                    <th>Anotações</th>
                </tr>

                {% for occurrence in occurrences %}
                    <tr>
                        <td>{{ occurrence.date }}</td>
                        <td><a href="{% url 'bus_detail' pk=occurrence.bus.pk %}">{{ occurrence.bus.line_number }} - {{ occurrence.bus.plate }}</a></td>
                        <td>{{ occurrence.alert_time }}</td>
                        <td>lat: {{ occurrence.latitude }} <br />long: {{ occurrence.longitude }}</td>
                        {% if occurrence.responded %}
                                <td>Sim</td>
                            {% else %}
                                <td>Não</td>
                            {% endif %}
                        {% if occurrence.responded %}
                            <td>{{ occurrence.response_time }}</td>
                            <td>{{ occurrence.responder.username }}</td>
                            <td>{{ occurrence.finish_time }}</td>
                            {% if occurrence.successfull %}
                                <td>Sim</td>
                            {% else %}
                                <td>Não</td>
                            {% endif %}
                            <td>{{ occurrence.notes }}</td>
                        {% else %}
                            <td>---</td>
                            <td>---</td>
                            <td>---</td>
                            <td>---</td>
                            <td>---</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Nenhuma ocorrência encontrada</p>
        {% endif %}
    </div>

{% endblock logged_content %}